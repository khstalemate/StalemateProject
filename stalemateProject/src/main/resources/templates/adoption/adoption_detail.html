<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>분양,입양 게시판 - 상세</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/board/adoption_detail.css">
    <script>window.FontAwesomeConfig = { autoReplaceSvg: "nest"};</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <th:block th:replace="~{common/header}"></th:block>

    <main class="page">
        <article class="section-card" th:object="${post}">
            <div class="section-head section-head-spacing">
                <div>
                    <div class="detail-meta">
                        <span th:text="*{category == '입양'} ? '입양' : '분양'"
                            th:classappend="*{category == '입양'} ? 'badge-primary' : 'badge-secondary'"
                            class="badge badge-secondary">카테고리</span>
                        <span class="muted">분양 &amp; 입양 게시판</span>
                    </div>
                    <h1 class="title-lg detail-title-spacing" th:text="*{postTitle}">제목</h1>
                    <div class="detail-meta detail-meta-spacing">
                        <span class="profile-info-small">
                            <img th:src="*{profileImg} ?: '/images/logo.jpg'" alt="Author" class="profile-avatar"> 
                            <strong th:text="*{memberName}">작성자</strong>
                        </span>
                        <span class="detail-meta-item" th:text="*{postDate}"><i class="fa-solid fa-calendar"></i>작성일</span>
                        <span class="detail-meta-item" th:text="*{views}"><i class="fa-solid fa-eye"></i>0</span>
                    </div>
                </div>
            </div>

            <th:block th:if="${imgList != null and #lists.size(imgList) > 0}">
                <div th:each="img:${imgList}" class="detail-cover">
                    <img th:src="|${img.imgPath}${img.imgRename}|" class="detail-img">
                </div>
            </th:block> 

            <div class="section" id="post-info">
                <div class="info-grid">
                    <div class="info-box">
                        <span class="info-icon"><i class="fa-solid fa-dog"></i></span>
                        <div>
                            <p class="muted info-label">품종 / 성별</p>
                            <strong th:text="|*{speciesText} / *{genderText}|">품종 / 성별</strong>
                            <p class="muted info-desc" th:text="|*{ageText}, *{weightText}|">나이, 체중</p>
                        </div>
                    </div>
                    <div class="info-box">
                        <span class="info-icon info-icon-green"><i class="fa-solid fa-heart"></i></span>
                        <div>
                            <p class="muted info-label">입양 상태</p>
                            <div th:switch="*{status}">
                                <strong th:case="'NOT_START'" class="info-text-primary">미해결</strong>
                                <strong th:case="'IN_PROGRESS'" class="info-text-primary">진행중</strong>
                                <strong th:case="'COMPLETE'" class="info-text-primary">완료</strong>
                            </div>
                        </div>
                    </div>
                    <div class="info-box">
                        <span class="info-icon"><i class="fa-solid fa-won-sign"></i></span>
                        <div>
                            <p class="muted info-label">입양 비용</p>
                            <strong th:text="*{adoptFee}">무료 입양</strong>
                            <th:block th:switch="*{status}">
                                <p th:case="'NOT_START'" class="muted info-desc">입양 신청 전</p>
                                <p th:case="'IN_PROGRESS'" class="muted info-desc">책임감 있는 가정 우선</p>
                                <p th:case="'COMPLETE'" class="muted info-desc">입양 완료</p>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>

            <section class="section" id="post-content">
                <div class="post-content" th:utext="${#strings.replace(post.content, '\n', '<br/>')}"></div>
            </section>

            <div class="section action-buttons">
                <th:block th:if="${session.loginMember != null and post.memberNo == session.loginMember.memberNo}">
                    <form th:action="@{/adoption/updateStatus}" method="post">
                        <input type="hidden" name="postNo" th:value="${post.postNo}">
                        <select name="status" style="display: none;" id="statusSelect" onchange="this.form.submit()">
                            <option th:value="'NOT_START'" th:selected="${post.status == 'NOT_START'}">미해결</option>
                            <option th:value="'IN_PROGRESS'" th:selected="${post.status == 'IN_PROGRESS'}">진행중</option>
                            <option th:value="'COMPLETE'" th:selected="${post.status == 'COMPLETE'}">완료</option>
                        </select>
                        <button type = "button" class="btn btn-primary" id="statusChangeBtn">상태 변경</button>
                    </form>
                    <button class="btn btn-primary"
                            th:onclick="|location.href='@{/adoption/{postNo}/update(postNo=*{postNo})}'|">수정</button>
                    <form th:action="@{/adoption/{postNo}/delete(postNo=*{postNo})}" method="post">
                        <button class="btn btn-primary" onclick="return confirm('게시글을 삭제하시겠습니까?');">삭제</button>
                    </form>
                </th:block>
                <button type="button" class="btn btn-secondary" id="goToList">목록</button>
                <button type="button" class="btn btn-secondary" id="reportBtn">신고</button>
            </div>
        </article>

        <section class="section-card section" id="comment-section">
            <h3 class="title-lg comment-title">
                댓글 <span class="link-primary" th:text="${post.replyList.size()}">0</span>
            </h3>

            <div class="section">
                <textarea class="form-control comment-textarea" rows="3" placeholder="응원의 댓글을 남겨주세요..." id="replyContent"></textarea>
                <div class="comment-actions">
                    <button id="insertReplyBtn" class="btn btn-primary">댓글 작성</button>
                </div>
            </div>

            <div class="section comment-list" id="replyList">
                <div class="comment-item" id="replyRow" th:each="reply : ${post.replyList}">
                    <img th:src="${reply.profileImg} ?: @{/images/logo.jpg}" alt="Commenter" class="profile-avatar-large">
                    <div>
                        <div class="detail-meta comment-meta" id="#replyNameTime">
                            <strong th:text="${reply.memberName}">이름</strong>
                            <span th:text="${reply.replyTime}">시간</span>
                        </div>
                        <p class="comment-text" th:text="${reply.replyContent}">내용</p>
                    </div>
                    <th:block th:if="${reply.memberNo == session.loginMember.memberNo}">
                        <button class="btn btn-primary updateReplyBtn">수정</button>
                        <button class="btn btn-primary deleteReplyBtn">삭제</button>
                    </th:block>
                </div>
            </div>
        </section>
    </main>

    <th:block th:replace="~{common/footer}"></th:block>
    <script th:inline="javascript">
        const loginMemberNo = /*[[${session.loginMember != null ? session.loginMember.memberNo : null}]]*/ null;
        const postNo        = /*[[${post.postNo}]]*/ null;
    </script>
    <script src="/js/board/adoption_detail.js"></script>
</body>
</html>


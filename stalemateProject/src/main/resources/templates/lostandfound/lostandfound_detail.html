<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${post.postTitle}">게시판 이름</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/board/lostandfound_detail.css">
    <script>window.FontAwesomeConfig = { autoReplaceSvg: "nest"};</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <th:block th:replace="~{common/header}"></th:block>

    <main class="page" th:object="${post}">
        <article class="section-card">
            <div class="section-head section-head-spacing">
                <div>
                    <div class="detail-meta">
                        <span th:text="*{category == '실종'} ? '실종' : '목격'"
                        class="badge" th:classappend="*{category == '실종'} ? 'badge-primary' : 'badge-secondary'">카테고리</span>
                        <span class="muted">실종 &amp; 목격 게시판</span>
                    </div>
                    <h1 class="title-lg detail-title-spacing" th:text="*{postTitle}">제목</h1>
                    <div class="detail-meta detail-meta-spacing">
                        <span class="profile-info-small">
                            <img th:src="*{profileImg} ?: '/images/logo.jpg'" alt="Author" class="profile-avatar"> 
                            <strong th:text="*{memberName}">작성자</strong>
                        </span>
                        <span class="detail-meta-item" th:text="*{postDate}"><i class="fa-solid fa-calendar"></i>작성일</span>
                        <span class="detail-meta-item" th:text="*{views}"><i class="fa-solid fa-eye"></i>
                            조회수 : <span th:text="*{views}">0</span>
                        </span>
                    </div>
                </div>
            </div>
            <th:block th:if="${imgList != null and #lists.size(imgList) > 0}">
                <div th:each="img:${imgList}" class="detail-cover">
                    <img th:src="|${img.imgPath}${img.imgRename}|" class="detail-img">
                </div>
            </th:block> 

            <div class="section" id="post-info">
                <div class="info-grid">
                    <div class="info-box">
                        <span class="info-icon info-icon-red"><i class="fa-solid fa-location-dot"></i></span>
                        <div>
                            <p class="muted info-label">실종 위치</p>
                            <strong th:text="*{location}">주소</strong>
                            <p class="muted info-desc" th:text="*{detailLocation}">상세 주소</p>
                        </div>
                    </div>
                    <div class="info-box">
                        <span class="info-icon info-icon-red"><i class="fa-solid fa-clock"></i></span>
                        <div>
                            <p class="muted info-label">실종 일시</p>
                            <strong th:text="*{missingDate}">실종 날짜</strong>
                            <p class="muted info-desc" th:text="*{missingTime}">실종 시간</p>
                        </div>
                    </div>
                    <div class="info-box">
                        <span class="info-icon"><i class="fa-solid fa-dog"></i></span>
                        <div>
                            <p class="muted info-label">반려동물 정보</p>
                            <strong th:text="|*{speciesText} / *{genderText}|">개 / 수컷</strong>
                            <p class="muted info-desc" th:text="|나이 *{ageText}|">나이</p>
                            <p class="muted info-desc" th:text="|체중 *{weightText}|">체중</p>
                        </div>
                    </div>
                    <div class="info-box">
                        <span class="info-icon info-icon-red"><i class="fa-solid fa-exclamation-triangle"></i></span>
                        <div>
                            <p class="muted info-label">해결 여부</p>
                            <div th:switch="*{status}">
                                <span th:case="'NOT_START'" class="badge badge-primary">미해결</span>
                                <span th:case="'IN_PROGRESS'" class="badge badge-green">진행중</span>
                                <span th:case="'COMPLETE'" class="badge badge-dark">완료</span>
                            </div>
                            <th:block th:switch="*{status}">
                                <p th:case="'NOT_START'" class="muted info-desc">수색 시작 전</p>
                                <p th:case="'IN_PROGRESS'" class="muted info-desc">적극 수색 중</p>
                                <p th:case="'COMPLETE'" class="muted info-desc">수색 완료</p>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>

            <section class="section" id="post-content">
                <div class="post-content" th:utext="${#strings.replace(post.content, '\n', '<br/>')}">내용</div>
            </section>

            <div class="section action-buttons">
                <th:block th:if="${session.loginMember != null and post.memberNo == session.loginMember.memberNo}">
                    <form th:action="@{/lostandfound/updateStatus}" method="post">
                        <input type="hidden" name="postNo" th:value="${post.postNo}">
                        <select name="status" style="display: none;" id="statusSelect" onchange="this.form.submit()">
                            <option th:value="'NOT_START'" th:selected="${post.status == 'NOT_START'}">미해결</option>
                            <option th:value="'IN_PROGRESS'" th:selected="${post.status == 'IN_PROGRESS'}">진행중</option>
                            <option th:value="'COMPLETE'" th:selected="${post.status == 'COMPLETE'}">완료</option>
                        </select>
                        <button type = "button" class="btn btn-primary" id="statusChangeBtn">상태 변경</button>
                    </form>
                    <button class="btn btn-primary"
                            th:onclick="|location.href='@{/lostandfound/{postNo}/update(postNo=*{postNo})}'|">수정</button>
                    <form th:action="@{/lostandfound/{postNo}/delete(postNo=*{postNo})}" method="post">
                        <button class="btn btn-primary" onclick="return confirm('게시글을 삭제하시겠습니까?');">삭제</button>
                    </form>
                </th:block>
                <button type="button" class="btn btn-secondary" id="goToList">목록</button>
                <button type="button" class="btn btn-secondary" id="reportBtn">신고</button>
            </div>
        </article>

        <section class="section-card section" id="comment-section">
            <h3 class="title-lg comment-title">
                댓글 <span class="link-primary" th:text="${post.replyList.size()}">0</span>
            </h3>

            <div class="section">
                <textarea class="form-control comment-textarea" rows="3" placeholder="응원의 댓글을 남겨주세요..." id="replyContent"></textarea>
                <div class="comment-actions">
                    <button id="insertReplyBtn" class="btn btn-primary">댓글 작성</button>
                </div>
            </div>

            <div class="section comment-list" id="replyList">
                <div class="comment-item" id="replyRow" th:each="reply : ${post.replyList}">
                    <img th:src="${reply.profileImg} ?: @{/images/logo.jpg}" alt="Commenter" class="profile-avatar-large">
                    <div>
                        <div class="detail-meta comment-meta" id="#replyNameTime">
                            <strong th:text="${reply.memberName}">이름</strong>
                            <span th:text="${reply.replyTime} + (${reply.replyUpdate} != null ? ' (수정됨)' : '')">
                                시간
                            </span>

                        </div>
                        <p class="comment-text" th:text="${reply.replyContent}">내용</p>
                    </div>
                    <th:block th:if="${reply.memberNo == session.loginMember.memberNo}">
                        <button class="btn btn-primary updateReplyBtn">수정</button>
                        <button class="btn btn-primary deleteReplyBtn">삭제</button>
                    </th:block>
                </div>
            </div>
        </section>
    </main>

    <th:block th:replace="~{common/footer}"></th:block>

    <!-- 전역 변수로 저장
    th:inline=javascript -> 해당 스크립트 내부가 js임을 알려줌
    /*[[...]]*/ -> 타임리프 js 인라인 표현식(타임리프 치환 문법) => js 입장에서는 주석+문자열만 존재, 실제 값 X
    ?. -> null-safe 연산자, NPE 방지 -->
    <script th:inline="javascript">
        const loginMemberNo = /*[[${session.loginMember != null} ? ${session.loginMember.memberNo} : null]]*/ null;
        const postNo = /*[[${post.postNo}]]*/ null;
    </script>
    <script src="/js/board/lostandfound_detail.js"></script>
</body>
</html>


<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.stale.mate.board.model.mapper.ReplyMapper">
	<!-- 작성자 : 최보윤
     작성일자 : 2025-01-02
     댓글 목록 조회 -->
	<select id="selectReply"  parameterType="int" resultType="com.stale.mate.board.model.dto.Reply">
	    SELECT REPLY_NO, REPLY_CONTENT, MEMBER_NO,
	           MEMBER_NAME AS "memberName",
	           PROFILE_IMG AS "profileImg",
	           <![CDATA[
	           CASE
	               WHEN SYSDATE - CAST(REPLY_TIME AS DATE) < 1 / 24 / 60
	                   THEN FLOOR((SYSDATE - CAST(REPLY_TIME AS DATE)) * 24 * 60 * 60) || '초 전'
	               WHEN SYSDATE - CAST(REPLY_TIME AS DATE) < 1 / 24
	                   THEN FLOOR((SYSDATE - CAST(REPLY_TIME AS DATE)) * 24 * 60) || '분 전'
	               WHEN SYSDATE - CAST(REPLY_TIME AS DATE) < 1
	                   THEN FLOOR((SYSDATE - CAST(REPLY_TIME AS DATE)) * 24) || '시간 전'
	               ELSE TO_CHAR(REPLY_TIME, 'YYYY.MM.DD')
	           END REPLY_TIME
	           ]]>
	    FROM REPLY
	    JOIN MEMBER USING(MEMBER_NO)
	    WHERE POST_NO = #{value}
	      AND REPLY_DELETE = 'N'
	</select>
	
	<!-- 작성자 : 최보윤
	     작성일자 : 2025-01-02
	     댓글 등록 -->
	<insert id="insertReply">
	    INSERT INTO REPLY (REPLY_NO, REPLY_CONTENT, REPLY_TIME, REPLY_UPDATE, REPLY_DELETE, POST_NO, MEMBER_NO)
	    VALUES(
	        SEQ_REPLY.NEXTVAL,
	        #{replyContent},
	        SYSDATE,
	        DEFAULT,
	        DEFAULT,
	        #{postNo},
	        #{memberNo}
	    )
	</insert>
	
	<!-- 작성자 : 최보윤
	     작성일자 : 2025-01-02
	     댓글 수정 -->
	<update id="updateReply">
	    UPDATE REPLY
	    SET REPLY_CONTENT = #{replyContent},
	        REPLY_UPDATE = SYSDATE
	    WHERE REPLY_NO = #{replyNo}
	</update>
	
	<!-- 작성자 : 최보윤
	     작성일자 : 2025-01-02
	     댓글 삭제 -->
	<update id="deleteReply">
	    UPDATE REPLY
	    SET REPLY_DELETE = 'Y'
	    WHERE REPLY_NO = #{replyNo}
	</update>
</mapper>